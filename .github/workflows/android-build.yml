name: Build Android App with Buildozer

on:
  push:
    branches:
      - main  # change if your default branch is different
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install buildozer cython

      - name: ğŸ“‚ Install Android SDK packages
        run: |
          yes | sdkmanager --licenses
          sdkmanager "platform-tools" "platforms;android-30" "build-tools;30.0.3" "ndk;23.1.7779620"

      - name: ğŸ§¹ Clean up duplicate android.sdk entries
        run: |
          sed -i '/^android.sdk = /d' buildozer.spec
          sed -i '/^android.ndk = /d' buildozer.spec
          sed -i '/^android.build_tools_version = /d' buildozer.spec

      - name: ğŸ›  Add correct SDK/NDK/build-tools versions
        run: |
          echo "android.sdk = 30" >> buildozer.spec
          echo "android.ndk = 23b" >> buildozer.spec
          echo "android.build_tools_version = 30.0.3" >> buildozer.spec

      - name: ğŸ— Build the APK
        run: buildozer android debug
